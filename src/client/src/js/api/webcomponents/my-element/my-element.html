<polymer-element name="my-element" attributes="user welcomeText">
  <template>
    <style>
      b {
        color: red;
      }
    </style>
    <should-be-visible if="alwaysAllow">
      {{(user && welcomeText) || deletedStr}}
    </should-be-visible>
    This is <b>{{user.firstName || deletedStr}} {{user.lastName || deletedStr}}</b>'s name-tag element.
    <label>
      first name:
      <input type="text" id="firstName" class="modelInput" value="{{user.firstName || deletedStr}}">
    </label>
    <label>
      last name:
      <input type="text" id="lastName" class="modelInput" value="{{user.lastName || deletedStr}}">
    </label>
    <button id="save" on-click="{{_doSave}}" class="modelInput">Save</button>
  </template>
  <script>
    Polymer('my-element', {

      _doSave: function () {
        const data = {
          firstName: this.$.firstName.value,
          lastName:  this.$.lastName.value
        };

        $(this).trigger('save', data);
      },

      deletedStr: '[DELETED]',

      ready: function () {
        const self = this;


        if (this.user) {
          this.user = JSON.parse(this.user);
        }

        $(this).on('datachange', function (ev, data) {
          _.extend(self, data);
          if (data.user) {
            $('.modelInput', this.shadowRoot).prop('disabled', false);
          } else {
            $('.modelInput', this.shadowRoot).prop('disabled', true);
          }
        });
      }

    });
  </script>
</polymer-element>
